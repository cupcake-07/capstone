<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Calendar Elegant View</title>
  <link rel="stylesheet" href="teacher.css" />
  <link rel="stylesheet" href="calendar.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- TOP NAVBAR -->
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-logo">
        <img src="g2flogo.png" class="logo-image"/>
      </div>
      <div class="navbar-text">
        <div class="navbar-title">Glorious God's Family</div>
        <div class="navbar-subtitle">Christian School</div>
      </div>
    </div>
    <div class="navbar-actions">
      <div class="user-menu">
        <span>Teacher</span>
        <a href="login.html">
        <img src="loginswitch.png" id="loginswitch"></img></a>
      </div>
    </div>
  </nav>

  <!-- MAIN PAGE CONTAINER -->
    <div class="page-wrapper">
    <!-- SIDEBAR -->
        <aside class="side">
            <nav class="nav">
                <a href="teacher.html">Dashboard</a>
                <a href="tprofile.html">Profile</a>
                <a href="student_schedule.html">Schedule</a>
                <a href="attendance.html">Attendance</a>
                <a href="listofstudents.html">Lists of students</a>
                <a href="grades.html">Grades</a>
                <a href="school_calendar.html" class="active">School Calendar</a>
                <a href="announcements.html">Announcements</a>
                <a href="teacherslist.html">Teachers</a>
                <a href="settings.html">Settings</a>
            </nav>
            <div class="side-foot">Logged in as <strong>Teacher</strong></div>
        </aside>

    <!-- MAIN CONTENT -->
        <main class="main">
            <header class="header">
                <h1>School Calendar</h1>
            </header>
        
            <section class="calendar-container">
                <div class="calendar-header">
                    <button id="prev-month" class="nav-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left">
                            <path d="m15 18-6-6 6-6"/></svg>
                    </button>
                    <h2 id="current-month-year">Month Year</h2>
                    <button id="next-month" class="nav-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right">
                            <path d="m9 18 6-6-6-6"/></svg>
                    </button>
                </div>

                <div class="calendar-grid">
                    <div class="day-name">Sun</div>
                    <div class="day-name">Mon</div>
                    <div class="day-name">Tue</div>
                    <div class="day-name">Wed</div>
                    <div class="day-name">Thu</div>
                    <div class="day-name">Fri</div>
                    <div class="day-name">Sat</div>
                </div>
                <div class="events-management-card card">
                    <div class="card-title" style="color: var(--green);">Add New School Event</div>
                    <form id="add-event-form">
                        <input type="date" id="event-date" required>
                        <input type="text" id="event-title" placeholder="Event Title" required>
                        <button type="submit">Add Event</button>
                    </form>
                    <div id="message-box"></div>
                </div>
                <div class="events-list-card card">
                    <div class="card-title">School Events for 
                        <span id="select-date-display">Today</span>
                    </div>
                    <ul id="events-lists">
                        <li>Loading events...</li>
                    </ul>
                </div>
            </section>
        </main>
    
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <p>123 Faith Avenue</p>
                    <p>Your City, ST 12345</p>
                    <p>Phone: (555) 123-4567</p>
                    <p>Email: info@gloriousgod.edu</p>
                </div>
                <div class="footer-section">
                    <h3>Connect With Us</h3>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook">
                            <svg xlmns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-facebook">
                                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
                            </svg>
                        </a>
                        <a href="#" aria-label="Instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-instagram">
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.5" y1="6.5" y2="6.5"/>
                            </svg>
                        </a>
                        <a href="#" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-twitter">
                                <path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2 1.7-1.4 1.2-4-1.2-5.4l-.4-.4a7.9 7.9 0 0 0-1.7-1.1c1.5-1.4 3.7-2 6.5-1.6 3-1.6 5.5-2.8 7.3-3.6 1.8.8 2.6 2.2 2.6 3.6z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>System Info</h3>
                    <p>Schoolwide Management System</p>
                    <p>Version 1.0.0</p>
                </div>
            <div class="footer-bottom">
                    <p>&copy; 2025 Glorious God Family Christian School. All rights reserved.</p>
                    <div class="footer-links">
                        <a href="privacy.html">Privacy Policy</a> |
                        <a href="terms.html">Terms of Service</a>
                    </div>
                <footer class="footer">Â© <span id="year">2025</span> Schoolwide Management System</footer>
            </div>
        </footer>

    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            // === DOM Elements ===
            const monthYearDisplay = document.getElementById('current-month-year');
            const calendarGrid = document.querySelector('.calendar-grid');
            const prevMonthButton = document.getElementById('prev-month');
            const nextMonthButton = document.getElementById('next-month');
            const addEventForm = document.getElementById('add-event-form');
            const eventDateInput = document.getElementById('event-date');
            const eventTitleInput = document.getElementById('event-title');
            const eventsList = document.getElementById('events-lists');
            const messageBox = document.getElementById('message-box');
            const selectDateDisplay = document.getElementById('select-date-display');
            const today = new Date();

            // === State Management ===
            let currentDate = new Date(); // Current date used for calendar navigation
            let selectedDate = new Date(today.getFullYear(), today.getMonth(), today.getDate()); // Date currently selected for event listing

            // *** IMPORTANT: Events will NOT persist when the page is reloaded. ***
            // This object now holds events only for the current session.
            let schoolEvents = {}; 

            // Helper function to format a Date object as 'YYYY-MM-DD' string
            const formatDateKey = (date) => {
                const d = new Date(date);
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            // Helper function to format a date for display
            const formatDisplayDate = (date) => {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('en-US', options);
            }

            // === Calendar Rendering Logic ===

            /**
             * Renders the calendar grid for the current month/year in `currentDate`.
             */
            const renderCalendar = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                // Update Month and Year in the header
                monthYearDisplay.textContent = currentDate.toLocaleDateString('en-US', {
                    month: 'long',
                    year: 'numeric'
                });

                // Clear existing days, but keep the day-names (first 7 children)
                while (calendarGrid.children.length > 7) {
                    calendarGrid.removeChild(calendarGrid.lastChild);
                }

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // 1. Add padding (empty) days
                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.classList.add('calendar-day', 'empty');
                    calendarGrid.appendChild(emptyDay);
                }

                // 2. Add actual days
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayDate = new Date(year, month, day);
                    const dateKey = formatDateKey(dayDate);

                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('calendar-day');
                    // Put the day number inside a span for better visual control
                    dayDiv.innerHTML = `<span>${day}</span>`; 
                    dayDiv.dataset.date = dateKey;
                    
                    // Check for 'today' class
                    const isToday = today.toDateString() === dayDate.toDateString();
                    if (isToday) {
                        dayDiv.classList.add('today');
                    }

                    // Check for 'selected' class
                    const isSelected = selectedDate && selectedDate.toDateString() === dayDate.toDateString();
                    if (isSelected) {
                        dayDiv.classList.add('selected');
                    }

                    // Check for 'has-event' and add a marker
                    if (schoolEvents[dateKey] && schoolEvents[dateKey].length > 0) {
                        dayDiv.classList.add('has-event');
                        const marker = document.createElement('div');
                        marker.classList.add('event-marker');
                        dayDiv.appendChild(marker);
                    }

                    // Add click listener
                    dayDiv.addEventListener('click', () => handleDayClick(dayDiv, dayDate));

                    calendarGrid.appendChild(dayDiv);
                }
                
                // Ensure the correct events are shown for the currently selected date
                updateEventsList(selectedDate);
            };

            /**
             * Handles navigation when the user clicks a day in the calendar.
             */
            const handleDayClick = (dayElement, dateObj) => {
                // 1. Remove 'selected' from all days
                document.querySelectorAll('.calendar-day.selected').forEach(d => {
                    d.classList.remove('selected');
                });

                // 2. Add 'selected' to the clicked day
                dayElement.classList.add('selected');

                // 3. Update the global selectedDate state
                selectedDate = dateObj;
                
                // 4. Update the events list display
                updateEventsList(selectedDate);
            };

            /**
             * Updates the events list card with events for a specific date.
             */
            const updateEventsList = (dateObj) => {
                const dateKey = formatDateKey(dateObj);
                const events = schoolEvents[dateKey] || [];
                
                // Update the card title
                selectDateDisplay.textContent = formatDisplayDate(dateObj);
                eventDateInput.value = dateKey; // Pre-fill the date input

                // Clear existing events
                eventsList.innerHTML = ''; 

                if (events.length === 0) {
                    const li = document.createElement('li');
                    li.textContent = 'No school events scheduled for this day.';
                    li.className = 'text-gray-500 italic';
                    eventsList.appendChild(li);
                } else {
                    events.forEach(event => {
                        const li = document.createElement('li');
                        // Use the event title as a data attribute for easy deletion lookup
                        li.innerHTML = `
                            <strong>${event.title}</strong> 
                            <button class="delete-event" data-title="${event.title}" data-date="${dateKey}" title="Delete Event">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500 hover:text-red-700">
                                <path d="M3 6h18"/>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                                <line x1="10" x2="10" y1="11" y2="17"/>
                                <line x1="14" x2="14" y1="11" y2="17"/>
                            </svg>
                            </button>`;
                        eventsList.appendChild(li);
                    });
                }
            };

            /**
             * Displays a temporary message in the message box.
             */
            const showMessage = (message, type) => {
                messageBox.textContent = message;
                messageBox.className = `message-box message-${type}`;
                messageBox.style.display = 'block';

                // Hide message after 4 seconds
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 4000);
            };

            // === Event Handlers ===

            // Handle month navigation
            prevMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            // Handle Add Event form submission
            addEventForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const dateKey = eventDateInput.value;
                const title = eventTitleInput.value.trim();

                if (dateKey && title) {
                    // Initialize array if it doesn't exist
                    if (!schoolEvents[dateKey]) {
                        schoolEvents[dateKey] = [];
                    }
                    
                    // Check for duplicate events
                    const isDuplicate = schoolEvents[dateKey].some(event => event.title.toLowerCase() === title.toLowerCase());
                    
                    if (isDuplicate) {
                         showMessage('Event with this title already exists on this day.', 'error');
                         return;
                    }

                    // Add the new event
                    schoolEvents[dateKey].push({ title: title });
                    
                    // Update UI
                    showMessage('Event added successfully! (Remember: This data is not saved permanently.)', 'success');
                    eventTitleInput.value = ''; // Clear input
                    
                    // Re-render calendar and events list to show new marker/list
                    renderCalendar();
                } else {
                    showMessage('Please enter both date and event title.', 'error');
                }
            });
            
            // Handle Delete Event button clicks
            eventsList.addEventListener('click', (e) => {
                const deleteButton = e.target.closest('.delete-event');
                if (deleteButton) {
                    const dateKey = deleteButton.dataset.date;
                    const eventTitle = deleteButton.dataset.title;

                    if (schoolEvents[dateKey]) {
                        // Filter out the event to be deleted
                        schoolEvents[dateKey] = schoolEvents[dateKey].filter(event => event.title !== eventTitle);

                        // If no more events for the day, remove the date key entirely
                        if (schoolEvents[dateKey].length === 0) {
                            delete schoolEvents[dateKey];
                        }

                        // Update UI
                        showMessage(`Event "${eventTitle}" deleted.`, 'success');
                        renderCalendar();
                        updateEventsList(selectedDate);
                    }
                }
            });


            // === Initialization ===
            
            // Initially render the calendar for the current month
            renderCalendar();
        });
    </script>
    </div> 
</body>
</html>
